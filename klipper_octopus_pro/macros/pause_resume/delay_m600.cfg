[delayed_gcode DELAY_M600]
gcode:
    # use set for easier reading
    {% set consumed=printer["gcode_macro F_CONSUMED"].filament_consumed %}
    {% set length=printer["gcode_macro F_CONSUMED"].filament_lenght %}
    # check if predetermine length is reached
    {% if printer.print_stats.filament_used|float <= (consumed|float + length|float) %}
    # start looping this script every second
    UPDATE_DELAYED_GCODE ID=DELAY_M600 DURATION=1
    {% else %}
    M600
    {% endif %}