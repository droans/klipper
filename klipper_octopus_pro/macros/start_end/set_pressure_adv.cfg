[gcode_macro _SET_PRESSURE_ADV]
description: Set the pressure advance for current filament
gcode:
    '''
    Filament:
        Layer Height: pressure advance
    '''

    {% set fil_type_param = 'filament' %}
    {% set layer_height_param = 'layer_height' %}

    {% set filaments = {
            'cc3d_silk_gold': {
                '0.6': 0.42
            },
            'esun_black': {
                '0.4': 0.66
            }
        }
    %}


    {% set fil_type = params[fil_type_param] %}

    {% if layer_height_param not in fil_type %}
        {% set layer_height = (fil_type.keys() | list)[0] %}
        M118 Layer Height not specified. Using layer height of {layer_height} instead
    {% else %}
        {% set layer_height = params[layer_height_param] %}
        
        {% if layer_height not in fil_type %}
            {% set pres_adv = (fil_type.keys() | list)[0] %}
            M118 Layer Height specified {layer_height} not present. 
            M118 Using {pres_adv} instead.
            M118 Please add layer height to macro.
        
        {% endif %}
    
    {% endif %}

    M118 Setting pressure advance to {pres_adv}

    SET_PRESSURE_ADVANCE ADVANCE={pres_adv}
    
    M118 Pressure advance set.