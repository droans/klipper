[gcode_macro START_PRINT]
description: Start print
gcode:
    {% set bed_temp_param = 'BED' %}
    {% set nozzle_temp_param = 'HOTEND' %}
    {% set z_height_param = 'FIRST_LAYER_Z_HEIGHT' %}

    {% set default_bed_temp = 45 %}
    {% set default_nozzle_temp = 200 %}
    {% set default_z_height = 0.3 %}

    {% set start_nozzle_temp_offset = -25 %}
    {% set safe_z_height = 5 %}

    {% set bed_temp = params[bed_temp_param] | default(default_bed_temp) | float %}
    {% set nozzle_temp = params[nozzle_temp_param] | default(default_nozzle_temp) | float %}
    {% set z_height = params[z_height_param] | default(default_z_height) | float %}

    {% set start_nozzle_temp = nozzle_temp + start_nozzle_temp_offset %}

    M118 Starting Print...
    M118 Nozzle Temp: Final: {nozzle_temp}, Start: {start_nozzle_temp}
    M118 Bed Temp: {bed_temp}
    G90
    M83
    M104 S{start_nozzle_temp}           ;   Set start nozzle temp
    M140 S{bed_temp}                    ;   Set final bed temperature 
    G4 S10                              ;   Wait a tiny bit so the hotend can heat up a bit
    G28                                 ;   Home
    M104 S{nozzle_temp}                 ;   Set final nozzle temp

    G1 Z{safe_z_height} F240
    
    G1 X2 Y3 F3000                     ; Move over a bit 
    
    M190 S{bed_temp}                    ;   Wait for bed to be ready
    M109 S{nozzle_temp}                 ;   Wait for nozzle to be ready

    _DRAW_PRIME_LINE Z_HEIGHT={z_height}

