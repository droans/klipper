[gcode_macro START_PRINT]
description: Start print
gcode:
    {% set bed_temp_param = 'BED' %}
    {% set nozzle_temp_param = 'HOTEND' %}
    {% set z_height_param = 'FIRST_LAYER_Z_HEIGHT' %}

    {% set default_bed_temp = 45 %}
    {% set default_nozzle_temp = 200 %}
    {% set default_z_height = 0.3 %}

    {% set start_nozzle_temp_offset = -25 %}
    {% set safe_z_height = 5 %}

    {% set bed_temp = params[bed_temp_param] | default(default_bed_temp) | float %}
    {% set nozzle_temp = params[nozzle_temp_param] | default(default_nozzle_temp) | float %}
    {% set z_height = params[z_height_param] | default(default_z_height) | float %}

    {% set start_nozzle_temp = nozzle_temp + start_nozzle_temp_offset %}

    {% set always_home = printer["gcode_macro _CONFIGS"].always_home_on_print_start %}
    {% set prime_nozzle = printer["gcode_macro _CONFIGS"].print_start_prime_nozzle %}
    {% set prime_nozzle_mm = printer["gcode_macro _CONFIGS"].print_start_prime_nozzle_mm | float %}

    SET_CONFIG_VAR VAR=print_bed_temp VAL={bed_temp}
    SET_CONFIG_VAR VAR=print_nozzle_temp VAL={nozzle_temp}
    SET_CONFIG_VAR VAR=print_first_layer_height VAL={z_height}

    M104 S{nozzle_temp}                 ;   Set final nozzle temp

    G1 Z{safe_z_height} F240
    
    G1 X2 Y3 F3000                     ; Move over a bit 
    
    M190 S{bed_temp}                    ;   Wait for bed to be ready
    M109 S{nozzle_temp}                 ;   Wait for nozzle to be ready

    _DRAW_PRIME_LINE Z_HEIGHT={z_height}

