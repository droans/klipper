[gcode_macro GET_PRINTER_OBJECT]
gcode:
    {% set request = params.OBJECT | default("printer") %}
    {% set only_keys = params.RETURN_KEYS | default(0) | int %}

    M118 {request}
    {% set ns = namespace(object=printer) %}

    {% if request == 'printer' %}
        {% set ns2 = namespace(objects=[]) %}
        {% for item in printer %}
            {% set ns2.objects = ns2.objects + [item] %}
        {% endfor %}

        M118 {ns2.objects}

    {% else %}
        {% set request = request.split(',') %}
        M118 {request}
        {% for item in request %}
            {% if item in ns.object %}
                {% set ns.object = ns.object[item] %}
            {% endif %}
        {% endfor %}

        {% if only_keys == 1 and ns.object is mapping %}
            M118 {ns.object.keys()}
        {% else %}
            M118 {ns.object}
        {% endif %}
    
    {% endif %}