[gcode_macro LOAD_MESH_TEMP]
description: Load Mesh at current temperature
gcode:

    {% set load_temp = params.TEMP | default(-1) | int | string %}

    {% if load_temp == -1 %}
        M118 Parameter `temp` not provided.
    {% else %}

        {% set mesh_name_short = 'temp_' + load_temp %}
        {% set mesh_name = 'bed_mesh ' + mesh_name_short %}

        {% if mesh_name not in printer.configfile.config %}
            M118 Cannot find mesh for temperature {load_temp}
            M118 Mesh Name {mesh_name_short} not found.

        {% else %}
            M118 Loading Bed Mesh named {mesh_name_short}
            BED_MESH_PROFILE LOAD={mesh_name_short}
        
        {% endif %}
    {% endif %}