[gcode_macro SET_CONFIG_VAR]
description: Set the value of a config variable
gcode:
    {% set echo = params.ECHO | default('no') %}
    {% set var = params.VAR | lower %}
    {% set val = params.VAL %}

    {% set config_vars = printer['gcode_macro _CONFIGS'] %}

    {% set echo_ignore_strs = [
            'no',
            'NO',
            'false',
            'FALSE',
            false,
            '0',
            '0.0',
            0,
            0.0
        ]
    %}

    {% set echo = (echo not in echo_ignore_strs) %}

    {% if echo %}
        M118 Current Value: {config_vars[var]}
        M118 Setting value to {val}
    {% endif %}

    {% set bool_vals = [
            'True',
            'true',
            'TRUE',
            'False',
            'false',
            'FALSE'
        ]
    %}

    {% if val not in bool_vals %}
        {% set val = val | float(val) %}

        {% if val is string %}
            {% set val = '"\'' + val + '\'"' %}
        {% endif %}

    {% else %}
    {% endif %}
    


    {% if var not in config_vars %}
        M118 Failed to to set config variable {var}.
        M118 Variable not found in config
        M118 Please check macros and correct this. 
    {% else %}

        SET_GCODE_VARIABLE MACRO=_CONFIGS VARIABLE={var} VALUE={val}
        {% if echo == 'yes' %}
            M118 Config variable {var} updated to {val}
        {% endif %}

    {% endif %}