[gcode_macro _LED_DEFAULT]
variable_rgb: [0,0,0]
variable_rgbw: [0,0,0,0]
variable_strips: ["left_case_leds","right_case_leds","left_side_leds","right_side_leds"]
gcode:
    {% set ns = namespace(strips=[]) %}
    {% for strip in strips %}
        {% set color_order = printer.configfile.settings['neopixel ' + strip].color_order | default(('rgb',)) %}
        {% set led_count = printer.configfile.settings['neopixel ' + strip].chain_count | int | default(1) %}
        {% if (color_order | length) == 1 %}
            {% set color_order = color_order * led_count %}
        {% endif %}
        
        {% for i in range((color_order | length)) %}
            {% set index = i + 1 %}
            {% set color = color_order[i] %}
            {% if 'w' in color %}
                SET_LED LED={strip} RED={rgbw[0]} GREEN={rgbw[1]} BLUE={rgbw[2]} WHITE={rgbw[3]} INDEX={i + 1} TRANSMIT=0
            {% else %}
                SET_LED LED={strip} RED={rgb[0]} GREEN={rgb[1]} BLUE={rgb[2]} INDEX={index} TRANSMIT=0
            {% endif %}
        {% endfor %}

        {% set color = color_order[-1] %}
        {% if 'w' in color %}
            SET_LED LED={strip} RED={rgbw[0]} GREEN={rgbw[1]} BLUE={rgbw[2]} WHITE={rgbw[3]} INDEX={index} TRANSMIT=1
        {% else %}
            SET_LED LED={strip} RED={rgb[0]} GREEN={rgb[1]} BLUE={rgb[2]} INDEX={index} TRANSMIT=1
        {% endif %}

    {% endfor %}