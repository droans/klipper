[gcode_macro PAUSE]
description: Pause the actual running print
rename_existing: PAUSE_BASE
gcode:
  {% set vars = printer['gcode_macro _CONFIGS'] %}

  {% set default_save_gcode_state = vars.pause_default_save_gcode_state %}
  {% set default_save_name = vars.pause_default_save_name %}
  {% set default_move_x = vars.pause_default_move_x %}
  {% set default_move_y = vars.pause_default_move_y %}
  {% set default_move_z = vars.pause_default_move_z %}

  {% set x = params.X | default(default_move_x) | float %}
  {% set y = params.Y | default(default_move_y) | float %}
  {% set z = params.Z | default(default_move_z) | float %}

  {% set save_gcode_state = params.SAVE_STATE | default(default_save_gcode_state) | int %}
  {% set save_gcode_name = params.NAME | default(default_save_name) %}

  {% set no_save_states = [
      False,
      'false',
      'False',
      'FALSE',
      0,
      0.0,
      '0',
      '0.0'
    ]
  %}

  {% if save_gcode_state not in no_save_states %}
    M118 Setting pause_gcode_state_saved to True
    SET_CONFIG_VAR VAR=pause_gcode_state_saved VAL=True

    M118 Saving gcode state {save_gcode_name}

    SAVE_GCODE_STATE NAME={save_gcode_name}

    M118 Recording saved state {save_gcode_name} to pause_save_name

    SET_CONFIG_VAR VAR=pause_save_name VAL={save_gcode_name}
  
  {% else %}
    M118 Not saving gcode state, setting pause_gcode_state_saved to False
    SET_CONFIG_VAR VAR=pause_gcode_state_saved VAL=False
  {% endif %}


  _LED_PRINT_PAUSED
  
  PAUSE_BASE