[gcode_macro _CONFIG_LEDS]
variable_colors: {
        "default": {
            "strip_name": ["left_case_leds","right_case_leds","left_side_leds","right_side_leds"],
            "red": 0.0,
            "green": 0.0,
            "blue": 0.0,
            "white": 0.0,
            "index": -1,
            "transmit": 1
        },
        "standby": {
            "strip_name": ["left_case_leds","right_case_leds","left_side_leds","right_side_leds","sb_leds"],
            "red": 0.0,
            "green": 0.0,
            "blue": 0.0,
            "white": 1.0,
            "index": -1,
            "transmit": 1
        },
        "printing": {
            "strip_name": ["left_case_leds","right_case_leds","left_side_leds","right_side_leds"],
            "red": 0.0,
            "green": 0.0,
            "blue": 0.0,
            "white": 1.0,
            "index": -1,
            "transmit": 1
        },
        "print_complete": {
            "strip_name": ["left_case_leds","right_case_leds","left_side_leds","right_side_leds","status_leds"],
            "red": 0.0,
            "green": 1.0,
            "blue": 0.0,
            "white": 0.0,
            "index": -1,
            "transmit": 1,
            "delayed_return": {
                "delay": 600,
                "macro": "_RETURN_LED_TO_STANDBY"
            }
        },
        "print_paused": {
            "strip_name": ["left_case_leds","right_case_leds","left_side_leds","right_side_leds"],
            "red": 1.0,
            "green": 0.75,
            "blue": 0.0,
            "white": 0.0,
            "index": -1,
            "transmit": 1
        },
        "print_error": {
            "strip_name": ["left_case_leds","right_case_leds","left_side_leds","right_side_leds"],
            "red": 1.0,
            "green": 0.0,
            "blue": 0.0,
            "white": 0.0,
            "index": -1,
            "transmit": 1
        },
        "idle_timeout": {
            "strip_name": ["left_case_leds","right_case_leds","left_side_leds","right_side_leds","status_leds"],
            "red": 1.0,
            "green": 0.25,
            "blue": 0.0,
            "white": 0.0,
            "index": -1,
            "transmit": 1,
            "sync": 0
        },
        "idle_off": {
            "strip_name": ["left_case_leds","right_case_leds","left_side_leds","right_side_leds","status_leds"],
            "red": 0.0,
            "green": 0.0,
            "blue": 0.0,
            "white": 0.0,
            "index": -1,
            "transmit": 1,
            "sync": 0
        },
        "idle_blink": {
            "strip_name": ["left_case_leds","right_case_leds","left_side_leds","right_side_leds","status_leds"],
            "red": 1.0,
            "green": 0.15,
            "blue": 0.0,
            "white": 0.0,
            "index": -1,
            "transmit": 1,
            "sync": 0
        },
        "progress": {
            "strip_name": "status_leds",
            "red": 0.0,
            "green": 0.0,
            "blue": 0.0,
            "white": 1.0,
            "update_delay_seconds": 10
        },
        "display": {
            "strip_name": "mini12864_led",
            "red": 0.0,
            "green": 1.0,
            "blue": 0.4,
            "white": 0.0,
            "index": -1,
            "transmit": 1
        }
    }
variable_state_colors: {
        "print_complete": "print_complete",
        "print_paused": "print_paused",
        "printing": "printing",
        "error": "print_error",
        "idle": "idle_timeout",
        "idle_off": "idle_off",
        "idle_blink": "idle_blink",
        "standby": "standby",
        "default": "default",
        "print_progress": "progress",
        "display": "display"
    }

gcode:
    {% set update = params.UPDATE | lower %}

    {% if update == 'colors' %}
        {% set color_name = params.NAME | lower %}
        {% set key = params.KEY | lower %}
        {% set val = params.VAL | lower %}

        {% if key == 'strips' %}
            {% set key = 'strip_name' %}
            {% set act = params.ACTION | lower %}
            {% set strips = colors[color_name]['strip_name'] %}

            {% if strips is string %}
                {% set strips = [strips] %}
            {% endif %}

            {% if act == 'add' %}

                {% if val not in strips %}
                    {% set strips = strips + [val] %}
                {% else %}
                    M118 {val} already present in {strips}!
                {% endif %}

            {% elif act == 'remove' %}

                {% if val in strips %}
                    {% set tmp = strips.pop(strips.index(val)) %}
                {% else %}
                    M118 {val} not present in {strips}!
                {% endif %}

            {% endif %}

            {% set tmp = colors[color_name].__setitem__('strip_name', strips) %}

        {% else %}
            {% set known_keys = ['red','green','blue','white','index','transmit'] %}

            {% if key in known_keys %}
                {% set tmp = colors[color_name].__setitem__(key, val) %}
            {% endif %}
        
        {% endif %}
    
        M118 {color_name}: {key} updated to {colors[color_name][key]}

    {% elif update == 'states' %}
        {% set state = params.STATE %}
        {% set color = params.COLOR %}
        {% set tmp = state_colors.__setitem__(state, color) %}
        M118 {state} updated to {color}
    {% endif %}