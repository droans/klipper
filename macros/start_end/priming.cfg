[gcode_macro _DRAW_PRIME_LINE]
description: Draw a prime line
gcode:
    {% set Z_HEIGHT = params.Z_HEIGHT | default(0.3) | float %}
    M118 Drawing prime line
    
    {% set initial_absolute = printer.gcode_move.absolute_coordinates %}

    G90
    G1 X2 Y3 F6000
    G1 Z{Z_HEIGHT} F240
    G92 E0
    G1 Y175 E10 F1500 ; Prime the nozzle. Split out into multiple smaller moves to allow for easier Z-Offset adjustments
    G1 X2.8 F1500 ; Move over slightly so we can run it back
    G92 E0
    G1 Y35 E10 F1500

    G21
    G90
    M82
    G92 E0

    {% if initial_absolute %}
        G90
    {% else %}
        G91
    {% endif %}

[gcode_macro _PRIME_NOZZLE]
gcode:
    {% set conf_vars = printer["gcode_macro _CONFIGS"] %}

    {% set prime_nozzle = conf_vars.print_start_prime_nozzle %}
    {% set prime_nozzle_mm = conf_vars.print_start_prime_nozzle_mm | float %}
    {% set prime_nozzle_speed = (conf_vars.print_start_prime_nozzle_speed * 60) | float %}

    M117 Priming...
    M118 priming Nozzle by {prime_nozzle_mm} mms
    M118 You may need to clean off excess filament

    G1 E{prime_nozzle_mm} F{prime_nozzle_speed}                         ;Prime the nozzle