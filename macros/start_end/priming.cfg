[gcode_macro _DRAW_PRIME_LINE]
description: Draw a prime line
gcode:
    {% set Z_HEIGHT = params.Z_HEIGHT | default(0.3) | float %}
    M118 Drawing prime line
    
    {% set initial_absolute = printer.gcode_move.absolute_coordinates %}

    G90
    G1 X2 Y3 F6000
    G1 Z{Z_HEIGHT} F240
    G92 E0
    G1 Y175 E10 F1500 ; Prime the nozzle. Split out into multiple smaller moves to allow for easier Z-Offset adjustments
    G1 X2.8 F1500 ; Move over slightly so we can run it back
    G92 E0
    G1 Y35 E10 F1500

    G21
    G90
    M82
    G92 E0

    {% if initial_absolute %}
        G90
    {% else %}
        G91
    {% endif %}

[gcode_macro _PURGE_NOZZLE]
gcode:
	{% set vars = printer['extended_macro _CONFIG_PRINT'].print_start %}

	{% set purge_nozzle_mm = vars.print_start.purge_nozzle_mm | float %}
	{% set purge_nozzle_speed = (vars.print_start.purge_nozzle_speed * 60) | float %}
	{% set def_purge_nozzle = vars.print_start.purge_nozzle | default(false) %}
	{% set purge_nozzle = params.PURGE | default(def_purge_nozzle) %}
	{% set true_results = [
			'YES',
			'yes',
			'TRUE',
			'true',
			'True',
			'Yes',
			True,
			1,
			1.0,
			'1'
		]
	%}

	{% if purge_nozzle in true_results %}
		M117 Purging...
		M118 Purging Nozzle by {purge_nozzle_mm} mms
		M118 You may need to clean off excess filament
		G1 E{purge_nozzle_mm} F{purge_nozzle_speed}                         ;Prime the nozzle
	{% else %}
		M118 Purge disabled
	{% endif %}