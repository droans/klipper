[gcode_macro SET_FILAMENT_PROPERTIES]
gcode:
    
    {% set max_accel = params.MAX_ACCEL | default(-1) | float %}
    {% set max_speed = params.MAX_SPEED | default(-1) | float %}
    {% set pressure_advance = params.PRESSURE_ADVANCE | default(-1) | float %}
    {% set square_corner_limit = params.SQUARE_CORNER_LIMIT | default(-1) | float %}
    {% set max_accel_to_decel = params.MAX_ACCEL_TO_DECEL | default(-1) | float %}

    {% set retract_amount = params.RETRACTION | default(-1) | float %}
    {% set retract_speed = params.RETRACT_SPEED | default(-1) | float %}
    {% set extra_unretract_amount = params.EXTRA_UNRETRACT_AMOUNT | default(-1) | float %}
    {% set unretract_speed = params.UNRETRACT_SPEED | default(-1) | float %}

    {% set conf_macro = "_CONFIGS" %}

    {% set var_names = {
            "max_accel": "print_max_accel",
            "max_speed": "print_max_speed",
            "pressure_advance": "print_pressure_advance",
            "square_corner_limit": "print_square_corner_limit",
            "max_accel_to_decel": "print_max_accel_to_decel",
            "retract_amount": "print_retract_mm",
            "retract_speed": "print_retract_speed",
            "extra_unretract_amount": "print_extra_unretract_mm",
            "unretract_speed": "print_unretract_speed"
        }
    
    %}

    {% set set_str = ['Setting:'] %}

    {% if max_accel != -1 %}
        SET_VELOCITY_LIMIT ACCEL={max_accel}
        {% set set_str = set_str + ['* Acceleration Limit to ' + max_accel | string] %}
        SET_CONFIG_VAR VAR={var_names.max_accel} VAL={max_accel}

    {% endif %}

    {% if max_speed != -1 %}
        SET_VELOCITY_LIMIT VELOCITY={max_speed}
        {% set set_str = set_str + ['* Max Velocity to ' + max_speed | string] %}
        SET_CONFIG_VAR VAR={var_names.max_speed} VAL={max_speed}

    {% endif %}

    {% if pressure_advance != -1 %}
        SET_PRESSURE_ADVANCE ADVANCE={pressure_advance}
        {% set set_str = set_str + ['* Pressure Advance to ' + pressure_advance | string] %}
        SET_CONFIG_VAR VAR={var_names.pressure_advance} VAL={pressure_advance}
    {% endif %}

    {% if square_corner_limit != -1 %}
        SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={square_corner_limit}
        {% set set_str = set_str + ['* Square Corner Limit Velocity to ' + square_corner_limit | string] %}
        SET_CONFIG_VAR VAR={var_names.square_corner_limit} VAL={square_corner_limit}

    {% endif %}

    {% if max_accel_to_decel != -1 %}
        SET_VELOCITY_LIMIT ACCEL_TO_DECEL={max_accel_to_decel}
        {% set set_str = set_str + ['* Max Accel to Decel to ' + max_accel_to_decel | string] %}
        SET_CONFIG_VAR VAR={var_names.max_accel_to_decel} VAL={max_accel_to_decel}
    {% endif %}

    {% if retract_amount != -1 %}
        SET_RETRACTION RETRACT_LENGTH={retract_amount}
        {% set set_str = set_str + ['* Retraction to ' + retract_amount | string] %}
        SET_CONFIG_VAR VAR={var_names.retract_amount} VAL={retract_amount}
    {% endif %}



    {% if retract_speed != -1 %}
        SET_RETRACTION RETRACT_SPEED={retract_speed}
        {% set set_str = set_str + ['* Retract speed to ' + retract_speed | string] %}
        SET_CONFIG_VAR VAR={var_names.retract_speed} VAL={retract_speed}
    {% endif %}

    {% if extra_unretract_amount != -1 %}
        SET_RETRACTION UNRETRACT_EXTRA_LENGTH={extra_unretract_amount}
        {% set set_str = set_str + ['* Unretract extra length to ' + extra_unretract_amount | string] %}
        SET_CONFIG_VAR VAR={var_names.extra_unretract_amount} VAL={extra_unretract_amount}
    {% endif %}

    {% if unretract_speed != -1 %}
        SET_RETRACTION UNRETRACT_SPEED={unretract_speed}
        {% set set_str = set_str + ['* Unretract speed to ' + unretract_speed | string] %}
        SET_CONFIG_VAR VAR={var_names.unretract_speed} VAL={unretract_speed}
    {% endif %}

    {% for item in set_str %}
        M118 {item}
    {% endfor %}